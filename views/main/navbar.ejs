<!-- CSS Link -->
<link rel="stylesheet" href="/stylesheets/navbar.css">

<!-- Top bar -->
<% var role=typeof role !=='undefined' ? role : null; %>
    <div class="topBar py-2 bg-light" id="topBar">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 centerOnMobile">
                    <select id="themeSelect" class="me-3 border-0">
                        <option value="system">System Theme</option>
                        <option value="light">Light Mode</option>
                        <option value="dark">Dark Mode</option>
                    </select>
                    <span class="d-none d-lg-inline-block d-md-inline-block d-sm-inline-block d-xs-none me-3"><strong>RMIT
                            University</strong></span>
                    <span class="me-3">
                        <i class="fa fa-barcode" aria-hidden="true"></i>
                        <strong>SGS - Group 5</strong></span>
                </div>
                <div
                    class="col-lg-6 col-md-6 col-sm-12 col-xs-12 d-none d-lg-block d-md-block-d-sm-block d-xs-none text-end">
                    <!-- <span class="me-3">
                    <a href="#" id="topBarLink"><i class="fa fa-truck" aria-hidden="true"></i> Shipping</a></span> -->


                    <% if (typeof role !==undefined) { %>
                        <% if (role==='admin' ) { %>
                            <span class="me-3">
                                <a href="/policies" id="topBarLink"><i class="fa fa-file" aria-hidden="true"></i>
                                    Policy</a></span>
                            <span class="me-3">
                                <a href="/admin" id="topBarLink"> <i class="fa fa-mouse-pointer" aria-hidden="true"></i>
                                    Admin</a>
                            </span>
                            <% } %>
                                <% } %>

                </div>
            </div>
        </div>
    </div>

    <!-- Navigation bar -->
    <nav class="navbar navbar-expand-lg bg-white sticky-top navbar-light p-3 " id="navbar">
        <div class="container">
            <!-- For mobile view -->
            <div class="d-flex justify-content-between align-items-center m-auto" style="height: 50px;">
                <a class="navbar-brand" href="/"><img src="/images/binanceLogo.png" width="40px" alt=""></a>
                <div class="mx-auto my-3 d-lg-none d-sm-block d-xs-block" id="search">
                    <div class="input-group">
                        <form action="/products/search" method="get" class="d-flex">
                            <input type="text" class="form-control border-warning searchInput" style="color:#7a7a7a"
                                id="searchBar" placeholder="" name="q">
                            <button class="btn btn-warning text-white" id="searchForm" type="submit">
                                <i class="fa fa-search" aria-hidden="true"></i>
                            </button>
                        </form>
                    </div>
                </div>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>

            <!-- For desktop view -->
            <div class=" collapse navbar-collapse" id="navbarNavDropdown">
                <div class="ms-auto d-none d-lg-block">
                    <div class="input-group">
                        <form action="/products/search" method="get" class="d-flex">
                            <input type="text" class="form-control border-warning searchInput" style="color:#7a7a7a"
                                id="searchBar" placeholder="" name="q">
                            <button class="btn btn-warning text-white" id="searchForm" type="submit">Search</button>
                        </form>
                    </div>
                </div>
                <ul class="navbar-nav ms-auto ">
                    <li class="nav-item">
                        <a class="nav-link mx-2 text-uppercase" active href="/">Home</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-uppercase" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false" style="margin: 0px 8px;">
                            Product
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown" id="dropdown-menu">
                            <!-- <li><a class="dropdown-item" href="/catalog">
                                <i class="fa fa-box" aria-hidden="true"></i> All products</a></li> -->
                            <li><a class="dropdown-item" href="/catalog/mobile"><i class="fa fa-mobile"
                                        aria-hidden="true"></i> Mobile</a></li>
                            <li><a class="dropdown-item" href="/catalog/laptop"><i class="fa fa-laptop"
                                        aria-hidden="true"></i>
                                    Laptop</a>
                            </li>
                            <li><a class="dropdown-item" href="/catalog/headphone"><i class="fa fa-headphones"
                                        aria-hidden="true"></i>
                                    Headphone</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link mx-2 text-uppercase no-noti" href="/forum">Forum</a>
                        <a class="nav-link mx-2 text-uppercase noti" style="display: none;" href="/forum">Forum <span
                                class="red-dot"></span></a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto ">
                    <li class="nav-item">
                        <a class="nav-link mx-2 text-uppercase" href="/cart">
                            <!-- <i class="fa fa-cart-shopping"></i> -->
                            Cart
                            <% if (typeof userId==='undefined' || userId===null) { %>
                                <% } else { %>
                                    <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                                    <% } %>
                                        <span class='badge badge-warning' id='lblCartCount'>
                                            <%= (typeof cartSize !=='undefined' ) ? cartSize : "" %>
                                        </span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <% if (typeof userId==='undefined' || userId===null) { %>
                            <a class="nav-link mx-2 text-uppercase" href="/login">
                                Login
                            </a>
                            <% } else { %>
                                <div class="dropdown nav-item">
                                    <a class="nav-link mx-2 text-uppercase dropdown-toggle" href="#" role="button"
                                        id="accountDropdown" data-bs-toggle="dropdown" aria-expanded="false"
                                        style="padding: 0;">
                                        <p style="margin-bottom: 0px;">
                                            <img src="<%= profileImg %>" alt="" width="40px" height="40px"
                                                style="border-radius: 50%;" title="<%= username %>">
                                        </p>
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown" id="dropdown-menu">
                                        <li><a class="dropdown-item" href="/account">
                                                <i class="fa fa-user" aria-hidden="true"></i> Account</a></li>

                                        <li>
                                            <a class="dropdown-item" href="/logout" id="logoutLink">
                                                <i class="fa fa-sign-out-alt" aria-hidden="true"></i>
                                                Log out</a>
                                        </li>
                                    </ul>
                                </div>
                                <% } %>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <% function capitalizeFirstLetter(string) { return string.charAt(0).toUpperCase() + string.slice(1); } %>
        <% if (!['Home' , 'Post' , 'About' , 'Orders' ].includes(title) && path !=='/products/search' ) { %>
            <nav aria-label="breadcrumb" id="breadcrumb">
                <ol class="breadcrumb" style="margin-bottom: 0 !important;">
                    <% if (title !=='Home' ) { %>
                        <li class="breadcrumb-item"><a href="/"><i class="fa fa-home" aria-hidden="true"></i> Home</a>
                        </li>
                        <% } %>
                            <% var pathParts=path.split('/').filter(Boolean); %>
                                <% for(var i=0; i < pathParts.length; i++) { %>
                                    <% if (pathParts[i] !=='catalog' && pathParts[i] !=='edit' ) { %>
                                        <% if (typeof user !=='undefined' && pathParts[i]===user.id) { %>
                                            <li class="breadcrumb-item">
                                                <a href="/account/edit/<%= user.id %>">
                                                    Editing <%=user.name%>'s account
                                                </a>
                                            </li>
                                            <% } else if (typeof product !=='undefined' && pathParts[i]===product.name)
                                                { %>
                                                <li class="breadcrumb-item">
                                                    <a href="/products/<%= product.id %>">
                                                        <%= capitalizeFirstLetter(pathParts[i]) %>
                                                    </a>
                                                </li>
                                                <% } else { %>
                                                    <li class="breadcrumb-item">
                                                        <a href="/<%= pathParts.slice(0, i+1).join('/') %>">
                                                            <%= capitalizeFirstLetter(pathParts[i]) %>
                                                        </a>
                                                    </li>
                                                    <% } %>
                                                        <% } %>
                                                            <% } %>
                </ol>
            </nav>
            <% } %>

                <!-- JS Link -->
                <script src="/js/navbar.js"></script>
                <script src="/socket.io/socket.io.js"></script>
                <script>
                    document.addEventListener('DOMContentLoaded', () => {
                        const socket = io();
                        const forumLinkNoNoti = document.querySelector('.no-noti')
                        const forumLinkNoti = document.querySelector('.noti')
                        forumLinkNoNoti.style.display = 'block'
                        forumLinkNoti.style.display = 'none'

                        function toggleNotification(show) {
                            if (show) {
                                forumLinkNoNoti.style.display = 'none'
                                forumLinkNoti.style.display = 'block'
                            } else {
                                forumLinkNoNoti.style.display = 'block'
                                forumLinkNoti.style.display = 'none'
                            }
                        }

                        toggleNotification(false)

                        socket.on('newPost', () => {
                            toggleNotification(true)
                        })

                        forumLinkNoNoti.addEventListener('click', () => {
                            toggleNotification(false)
                        })
                        forumLinkNoti.addEventListener('click', () => {
                            toggleNotification(false)
                        })
                    })
                </script>